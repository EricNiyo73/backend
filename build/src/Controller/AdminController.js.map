{"version":3,"file":"AdminController.js","names":["_AdminModel","_interopRequireDefault","require","_bookUserModel","_express","_bodyParser","_multer","_path","_dotenv","_cloudinary","obj","__esModule","default","router","Router","dotenv","config","app","express","use","static","path","join","process","cwd","bodyParser","urlencoded","extended","json","cloudinary","cloud_name","env","CLOUDNAME","api_key","API_KEY","api_secret","API_SECRET","upload","multer","storage","diskStorage","fileFilter","req","file","cb","ext","extname","originalname","Error","error","exports","createfacility","res","next","result","uploader","newfacility","facility","image","secure_url","facilityTitle","body","subFacility","capacity","desc","savedfacility","save","status","err","updatefacility","updatedfacility","findByIdAndUpdate","params","id","$set","new","deletefacility","findByIdAndDelete","getfacilit","findById","getfacility","facilit","find","bookrequest","bookingRequest","BookingRequest","message","console"],"sources":["../../../src/Controller/AdminController.js"],"sourcesContent":["import facility from \"../model/AdminModel.js\";\r\nimport BookingRequest from \"../model/bookUserModel\";\r\nimport  Router  from 'express';\r\nconst router = Router();\r\nimport bodyParser from 'body-parser';\r\nimport multer from \"multer\";\r\nimport path from \"path\";\r\nimport express from \"express\";\r\nimport dotenv from 'dotenv';\r\ndotenv.config();\r\nconst app = express();\r\nrouter.use(\"/images\", express.static(path.join(process.cwd(), \"/images\")));\r\nrouter.use(bodyParser.urlencoded({ extended: true }))\r\nrouter.use(bodyParser.json());\r\n// ===================cloudinary configuration=======================\r\nimport { v2 as cloudinary } from 'cloudinary';\r\ncloudinary.config({\r\n  cloud_name:process.env.CLOUDNAME,\r\n  api_key:process.env.API_KEY,\r\n  api_secret:process.env.API_SECRET\r\n});\r\nexport var upload = multer({\r\n  storage: multer.diskStorage({}),\r\n  fileFilter: (req, file, cb) => {\r\n    try {\r\n      let ext = path.extname(file.originalname);\r\n      if (ext !== \".pdf\" && ext !== \".JPG\" && ext !== \".JPEG\" && ext !== \".PNG\" && ext !== \".jpg\" && ext !== \".jpeg\" && ext !== \".png\"){\r\n        return cb(new Error(\"File type is not supported\"), false);\r\n      }\r\n      cb(null, true);\r\n    } catch (error) {\r\n      return cb(error, false);\r\n    }\r\n  },\r\n});\r\n// import { createError } from \"../utils/error.js\";\r\n\r\n// ==================creation of availability facility===========\r\nexport const createfacility = async (req, res, next) => {\r\n  const result = await cloudinary.uploader.upload(req.file.path);\r\n  const newfacility = new facility({\r\n    image: result.secure_url,\r\n    facilityTitle: req.body.facilityTitle,\r\n    subFacility:req.body.subFacility,\r\n    capacity: req.body.capacity,\r\n    desc:req.body.desc,\r\n  });\r\n\r\n  try {\r\n    const savedfacility = await newfacility.save();\r\n    res.status(200).json(savedfacility);\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n};\r\n\r\n// ==================update facility==========================\r\n\r\nexport const updatefacility = async (req, res, next) => {\r\n    try {\r\n      const updatedfacility = await facility.findByIdAndUpdate(\r\n        req.params.id,\r\n        { $set: req.body },\r\n        { new: true }\r\n      );\r\n      res.status(200).json(updatedfacility);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n//   =======================update availability=========================\r\n\r\n// export const updatefacilityAvailability = async (req, res, next) => {\r\n//     try {\r\n//       await facility.updateOne(\r\n//         { \"facilityNumbers._id\": req.params.id },\r\n//         {\r\n//           $push: {\r\n//             \"facilityNumbers.$.unavailableDates\": req.body.dates\r\n//           },\r\n//         }\r\n//       );\r\n//       res.status(200).json(\"facility status has been updated.\");\r\n//     } catch (err) {\r\n//       next(err);\r\n//     }\r\n//   };\r\n\r\n//   ==============================delete availability==========================\r\n\r\nexport const deletefacility = async (req, res, next) => {\r\n    try {\r\n      await facility.findByIdAndDelete(req.params.id);\r\n      res.status(200).json(\"facility has been deleted.\");\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n  // =======================get one facility=============================\r\n  export const getfacilit = async (req, res, next) => {\r\n    try {\r\n      const getfacilit = await facility.findById(req.params.id);\r\n      res.status(200).json(getfacilit);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n//   ==========================get facility availability==========================\r\nexport const getfacility = async (req, res, next) => {\r\n    try {\r\n      const facilit = await facility.find();\r\n      res.status(200).json(facilit);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n// \r\n// =======================admin for approving a request=================\r\n\r\n// Endpoint for admins to approve or reject booking requests\r\nexport const bookrequest= async (req, res) => {\r\n  try {\r\n    const bookingRequest = await BookingRequest.findById(req.params.id);\r\n    if (!bookingRequest) {\r\n      return res.status(404).json({ message: 'Booking request not found' });\r\n    }\r\n    if (req.body.status === 'Approved') {\r\n      bookingRequest.status = req.body.status;\r\n      await bookingRequest.save();\r\n      res.json({ message: 'Booking request approved successfully' });\r\n    } else if (req.body.status === 'Rejected'){\r\n      bookingRequest.status = req.body.status;\r\n      await bookingRequest.save();\r\n      res.json({ message: 'Booking request rejected successfully' });\r\n    }\r\n    else {\r\n      res.status(400).json({ message: 'Invalid booking request status' });\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).json({ message: 'Failed to update booking request' });\r\n  }\r\n};"],"mappings":"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"}